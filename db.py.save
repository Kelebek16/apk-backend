# backend/db.py
import psycopg2
from psycopg2.pool import SimpleConnectionPool
from config import Config

# Global connection pool
pool = None

def init_db():
    global pool
    if pool is None:
        pool = SimpleConnectionPool(
            minconn=1,
            maxconn=10,
            user=Config.DB_USER,
            password=Config.DB_PASSWORD,
            host=Config.DB_HOST,
            port=Config.DB_PORT,
            database=Config.DB_NAME,
        )
        print("[DB] Connection pool initialized")

def get_conn():
    if pool is None:
        raise RuntimeError("DB pool is not initialized. Call init_db() first.")
    return pool.getconn()

def put_conn(conn):
    if pool is not None and conn is not None:
        pool.putconn(conn)

def close_pool():
    global pool
    if pool is not None:
        pool.closeall()
        pool = None
        print("[DB] Connection pool closed")
